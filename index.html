<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-title" content="RiaWeather" />
<!-- ç€è¦½å™¨ç‹€æ…‹åˆ—é¡è‰² -->
<meta name="theme-color" content="#67b7f3">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<!-- ä¿ç•™ Apple æ¨™ç±¤ -->
<meta name="apple-mobile-web-app-capable" content="yes">
<!-- æ–°å¢ Android / é€šç”¨ PWA æ¨™ç±¤ -->
<meta name="mobile-web-app-capable" content="yes">

<title>RiaWeather</title>
<link rel="icon" type="image/png" href="img/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="img/favicon.svg" />
<link rel="shortcut icon" href="img/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="manifest" href="manifest.json">


<style>
:root {
    --ac-dark-blue: #05499f;
    --ac-cream: #FFFEF2;
    --ac-blue: #4FB5D9;
    --ac-dark: #001e46;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: 'Noto Sans TC', sans-serif;
    letter-spacing: 0.05em;   /* âœ… å­—è·èª¿æ•´ */
    background-color: #67b7f3;
    background-image: 
        radial-gradient(rgba(255,255,255,0.5) 2px, transparent 2px),
        radial-gradient(rgba(255,255,255,0.5) 2px, #67b7f3 2px);
    background-size: 100px 100px;
    background-position: 0 0, 40px 40px;
    min-height: 100vh;
    color: var(--ac-dark);
    overflow-x: hidden;
    padding-bottom: 20px;
}

/* é ‚éƒ¨ç‹€æ…‹åˆ— */
.status-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background: #67b7f3;
    backdrop-filter: none;
    position: sticky;
    top: 0;
    z-index: 100;
}

.location-pill {
    display: inline-flex;
    align-items: center;
    background: transparent;
    color: white;
    padding: 5px 15px;
    font-weight: 500;
    font-size: 1.1rem;
    letter-spacing: 0.05em;
}

.location-pill i {
    margin-right: 6px;
}

.update-pill {
    font-size: 0.85rem;
    color: white;
    background: transparent;
    font-weight: 400;
    letter-spacing: 0.03em;
    padding: 4px 10px;
}

.container {
    padding: 40px 20px 20px 20px;
    max-width: 600px;
    margin: 0 auto;
}

/* ä»Šæ—¥ç„¦é»å¡ç‰‡ */
.hero-card {
    background: #ffffff;        /* ç´”ç™½ */
    border-radius: 35px;
    padding: 30px 25px;
    text-align: center;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08); /* ä¿ç•™æ·¡é™°å½± */
    border: none;               /* ç§»é™¤é‚Šæ¡† */
    margin-bottom: 40px;
    position: relative;
}


.hero-period {
    position: absolute;
    top: -15px;
    left: 50%;
    transform: translateX(-50%);
    background: #1E96F0;
    color: white;
    padding: 5px 20px;
    border-radius: 20px;
    font-weight: 500;
    border: 3px solid white;
    box-shadow: 0 4px 0 rgba(0, 0, 0, 0.1);
}

.hero-temp-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin: 15px 0;
}

.hero-icon {
    font-size: 5rem;
    filter: drop-shadow(0 4px 0 rgba(0, 0, 0, 0.1));
    animation: bounce 3s infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.hero-temp {
    font-size: 4.5rem;
    font-weight: 900;
    color: var(--ac-dark-blue);
    line-height: 1;
}

.hero-desc {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--ac-dark-blue);
    margin-bottom: 20px;
}

/* å¿«é€Ÿå»ºè­°å€ */
.advice-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 2px dashed #bbc5d6;
}

.advice-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: rgba(255, 255, 255, 0.5);
    padding: 10px;
    border-radius: 20px;
}

.advice-icon {
    font-size: 2rem;
    margin-bottom: 5px;
}

.advice-text {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--ac-dark-blue);
    margin: 5px 0;
    line-height: 1.2;
}

.small-text {
    font-size: 0.9rem;
    color: #8f9fba;
    margin-top: 5px;
}

/* ç¨å¾Œé å ±å€ */
.section-title {
    font-size: 1.2rem;
    color: white;
    margin-bottom: 15px;
    margin-left: 10px;
    font-weight: 500;
    text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
}

.scroll-container {
    display: flex;
    gap: 15px;
    overflow-x: auto;
    padding-bottom: 10px;
    width: 100%;              /* âœ… æ’æ»¿ container */
    box-sizing: border-box;
}


.scroll-container::-webkit-scrollbar {
    display: none;
}

.mini-card {
    width: calc(50% - 8px);  /* âœ… ä¸€è¡Œå…©å¼µï¼Œèˆ‡ä¸Šæ–¹å¡ç‰‡åŒå¯¬ */
    background: rgba(255, 255, 255, 0.7);  /* é™ä½é€æ˜åº¦ */
    border-radius: 25px;
    padding: 20px 15px;
    text-align: center;
    border: none;                         /* âœ… ç„¡é‚Šæ¡† */
    box-shadow: 0 6px 12px rgba(0,0,0,0.05); /* æ·¡é™°å½± */
    flex-shrink: 0;
}



.mini-time {
    background: #1E96F0;
    color: white;
    padding: 3px 12px;
    border-radius: 999px;
    font-size: 0.85rem;
    display: inline-block;
    margin-bottom: 10px;
    font-weight: 400;
}

.mini-icon {
    font-size: 2.5rem;
    margin: 5px 0;
}

.mini-temp {
    font-size: 1.2rem;
    font-weight: 800;
    color: var(--ac-dark-blue);
}

/* Loading ç•«é¢ */
.loading-screen {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: #67b7f3;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 999;
}

.loading-screen p {
    font-weight: 500;
    font-size: 1rem;
    color: white;
    margin-top: 20px;
}

</style>
</head>

<body>
<div id="loading" class="loading-screen">
    <div>
        <img src="img/favicon.svg" style="width: 4rem; animation: bounce 2s infinite;">
    </div>
    <p>å¤©æ°£ç²¾éˆæ­£åœ¨è§€æ¸¬é›²çš„æµå‹•...</p>
</div>

<div class="status-bar">
    <div class="location-pill">
        <i class="fa-solid fa-location-dot" style="color:white;"></i> å—æŠ•ç¸£
    </div>
    <div id="updateTime" class="update-pill">æ›´æ–°ä¸­...</div>
</div>

<div class="container" id="mainContent" style="display: none;">
    <div id="heroCard"></div>
    <h3 class="section-title">ç¨å¾Œé å ±</h3>
    <div class="scroll-container" id="futureForecasts"></div>
</div>

<script>
const API_URL = "https://ria-weather.zeabur.app/api/weather/kaohsiung";

function getWeatherIcon(weather) {
    if (!weather) return "ğŸŒ¤ï¸";
    if (weather.includes("æ™´")) return "â˜€ï¸";
    if (weather.includes("å¤šé›²")) return "â›…";
    if (weather.includes("é™°")) return "â˜ï¸";
    if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
    if (weather.includes("é›·")) return "â›ˆï¸";
    return "ğŸŒ¤ï¸";
}

function getAdvice(rainProb, maxTemp) {
    let rainIcon = "ğŸŒ‚", rainText = "ä¸ç”¨å¸¶å‚˜";
    if (parseInt(rainProb) > 30) { rainIcon = "â˜‚ï¸"; rainText = "è¨˜å¾—å¸¶å‚˜ï¼"; }

    let clothIcon = "ğŸ‘•", clothText = "èˆ’é©ç©¿æ­";
    if (parseInt(maxTemp) >= 28) { clothIcon = "ğŸ½"; clothText = "çŸ­è¢–å‡ºç™¼"; }
    else if (parseInt(maxTemp) <= 20) { clothIcon = "ğŸ§¥"; clothText = "åŠ ä»¶å¤–å¥—"; }

    return { rainIcon, rainText, clothIcon, clothText };
}

function getTimePeriod(startTime) {
    const hour = new Date(startTime).getHours();
    if (hour >= 5 && hour < 11) return "æ—©ä¸Š";
    if (hour >= 11 && hour < 14) return "ä¸­åˆ";
    if (hour >= 14 && hour < 18) return "ä¸‹åˆ";
    if (hour >= 18 && hour < 23) return "æ™šä¸Š";
    return "æ·±å¤œ";
}

function renderWeather(data) {
    const forecasts = data.forecasts;
    const current = forecasts[0];
    const others = forecasts.slice(1);

    const advice = getAdvice(current.rain, current.maxTemp);
    const period = getTimePeriod(current.startTime);
    const avgTemp = Math.round((parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2);

    document.getElementById('heroCard').innerHTML = `
        <div class="hero-card">
            <div class="hero-period">${period}</div>
            <div class="hero-temp-container">
                <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
                <div class="hero-temp">${avgTemp}Â°</div>
            </div>
            <div class="hero-desc">${current.weather}</div>

            <div class="advice-grid">
                <div class="advice-item">
                    <div class="advice-icon">${advice.rainIcon}</div>
                    <div class="advice-text">${advice.rainText}</div>
                    <div class="small-text">é™é›¨ç‡ ${current.rain}</div>
                </div>
                <div class="advice-item">
                    <div class="advice-icon">${advice.clothIcon}</div>
                    <div class="advice-text">${advice.clothText}</div>
                    <div class="small-text">æœ€é«˜æº« ${parseInt(current.maxTemp)}Â°</div>
                </div>
            </div>
        </div>
    `;

    const scrollContainer = document.getElementById('futureForecasts');
    scrollContainer.innerHTML = '';

    const todayDate = new Date().getDate();

    others.forEach(f => {
        let p = getTimePeriod(f.startTime);
        const fDate = new Date(f.startTime);
        if (fDate.getDate() !== todayDate) p = "æ˜å¤©" + p;

        scrollContainer.innerHTML += `
            <div class="mini-card">
                <div class="mini-time">${p}</div>
                <div class="mini-icon">${getWeatherIcon(f.weather)}</div>
                <div class="mini-temp">${parseInt(f.minTemp)}Â° - ${parseInt(f.maxTemp)}Â°</div>
                <div class="small-text">ğŸ’§ ${f.rain}</div>
            </div>
        `;
    });

    const now = new Date();
    const month = now.getMonth() + 1;
    const date = now.getDate();
    const dayIndex = now.getDay();
    const days = ["æ˜ŸæœŸæ—¥","æ˜ŸæœŸä¸€","æ˜ŸæœŸäºŒ","æ˜ŸæœŸä¸‰","æ˜ŸæœŸå››","æ˜ŸæœŸäº”","æ˜ŸæœŸå…­"];

    document.getElementById('updateTime').textContent = `${month}æœˆ${date}æ—¥ ${days[dayIndex]}`;
}

async function fetchWeather() {
    try {
        const delayPromise = new Promise(resolve => setTimeout(resolve, 1500));
        const fetchPromise = fetch(API_URL).then(res => res.json());
        const [_, json] = await Promise.all([delayPromise, fetchPromise]);

        if (json.success) {
            renderWeather(json.data);
            document.getElementById('loading').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
        } else throw new Error("API Error");
    } catch (e) {
        console.error(e);
        alert("å¤©æ°£è³‡æ–™è®€å–å¤±æ•—ï¼Œç‹¸å…‹æŠŠç¶²è·¯ç·šå’¬æ–·äº†ï¼");
    }
}

document.addEventListener("DOMContentLoaded", fetchWeather);

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("./sw.js")
    .then(reg => console.log("âœ… Service Worker registered", reg.scope))
    .catch(err => console.log("âŒ Service Worker failed", err));
}
</script>
</body>
</html>
